{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Dialog,DialogTitle,DialogContent,DialogActions,Button,TextField,FormControlLabel,Switch,Grid,Typography,Box,Alert,Divider,Chip,IconButton,Tooltip,MenuItem,Select,FormControl,InputLabel}from'@mui/material';import{Settings,Delete,DeleteForever,Warning,Security,Group,Chat,VolumeOff,Public,Lock,Save,Cancel}from'@mui/icons-material';import{roomsAPI}from'../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const RoomSettings=_ref=>{let{open,onClose,room,isHost,onRoomUpdated,onRoomDeleted}=_ref;const[settings,setSettings]=useState({title:'',description:'',max_participants:100,is_public:true,category:'',allow_chat:true,allow_reactions:true,require_approval:false,mute_participants:false});const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[success,setSuccess]=useState('');const[showDeleteConfirm,setShowDeleteConfirm]=useState(false);const[deleteType,setDeleteType]=useState('soft');// 'soft' or 'permanent'\nconst categories=['Music','Podcasts','Talk Show','Study Session','Gaming','Social','Educational','Entertainment','Other'];useEffect(()=>{console.log('🔧 RoomSettings useEffect triggered:',{room:!!room,open,roomId:room===null||room===void 0?void 0:room.id});if(room&&open){loadSettings();}},[room,open]);const loadSettings=async()=>{try{setLoading(true);console.log('🔧 Loading room settings for room:',room.id);const response=await roomsAPI.getSettings(room.id);console.log('✅ Room settings loaded:',response.data);setSettings(response.data.settings);}catch(error){var _error$response;console.error('❌ Failed to load room settings:',error);console.error('❌ Error details:',((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);setError('Failed to load room settings');}finally{setLoading(false);}};const handleInputChange=(field,value)=>{setSettings(prev=>({...prev,[field]:value}));setError('');};const handleSaveSettings=async()=>{try{setLoading(true);setError('');const response=await roomsAPI.updateSettings(room.id,settings);setSuccess('Room settings updated successfully!');if(onRoomUpdated){onRoomUpdated(response.data.room);}setTimeout(()=>{setSuccess('');onClose();},2000);}catch(error){var _error$response2,_error$response2$data;setError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Failed to update room settings');console.error('Update settings error:',error);}finally{setLoading(false);}};const handleDeleteRoom=async()=>{try{setLoading(true);setError('');await roomsAPI.delete(room.id,deleteType==='permanent');if(onRoomDeleted){onRoomDeleted(room.id,deleteType==='permanent');}setShowDeleteConfirm(false);onClose();}catch(error){var _error$response3,_error$response3$data;setError(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.error)||'Failed to delete room');console.error('Delete room error:',error);}finally{setLoading(false);}};const handleClose=()=>{setShowDeleteConfirm(false);setError('');setSuccess('');onClose();};console.log('🔧 RoomSettings render:',{room:!!room,open,isHost,roomTitle:room===null||room===void 0?void 0:room.title});if(!room){console.log('❌ RoomSettings: No room provided');return null;}return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,maxWidth:\"md\",fullWidth:true,PaperProps:{sx:{minHeight:'70vh',background:'rgba(255, 255, 255, 0.1)',backdropFilter:'blur(20px)',borderRadius:'24px',border:'1px solid rgba(255, 255, 255, 0.2)',color:'white'}},children:[/*#__PURE__*/_jsx(DialogTitle,{sx:{color:'white'},children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsx(Settings,{}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Room Settings\"}),/*#__PURE__*/_jsx(Chip,{label:isHost?'Host':'Participant',color:isHost?'primary':'default',size:\"small\",sx:{background:isHost?'linear-gradient(45deg, #4ECDC4, #44A08D)':'rgba(255, 255, 255, 0.2)',color:'white',border:'none'}})]})}),/*#__PURE__*/_jsxs(DialogContent,{dividers:true,sx:{color:'white'},children:[error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:2,background:'rgba(244, 67, 54, 0.1)',color:'#ff9999',border:'1px solid rgba(244, 67, 54, 0.3)','& .MuiAlert-icon':{color:'#ff9999'}},children:error}),success&&/*#__PURE__*/_jsx(Alert,{severity:\"success\",sx:{mb:2,background:'rgba(76, 175, 80, 0.1)',color:'#99ff99',border:'1px solid rgba(76, 175, 80, 0.3)','& .MuiAlert-icon':{color:'#99ff99'}},children:success}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",gutterBottom:true,sx:{display:'flex',alignItems:'center',gap:1,color:'white',fontWeight:'bold'},children:[/*#__PURE__*/_jsx(Group,{}),\"Basic Information\"]}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2,borderColor:'rgba(255, 255, 255, 0.2)'}})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:8,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Room Title\",value:settings.title,onChange:e=>handleInputChange('title',e.target.value),disabled:!isHost||loading,required:true,sx:{'& .MuiOutlinedInput-root':{background:'rgba(255, 255, 255, 0.1)',borderRadius:'12px','& fieldset':{borderColor:'rgba(255, 255, 255, 0.3)'},'&:hover fieldset':{borderColor:'rgba(255, 255, 255, 0.5)'},'&.Mui-focused fieldset':{borderColor:'#4ECDC4'}},'& .MuiInputLabel-root':{color:'rgba(255, 255, 255, 0.7)'},'& .MuiInputBase-input':{color:'white'}}})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:4,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{sx:{color:'rgba(255, 255, 255, 0.7)'},children:\"Category\"}),/*#__PURE__*/_jsx(Select,{value:settings.category||'',label:\"Category\",onChange:e=>handleInputChange('category',e.target.value),disabled:!isHost||loading,sx:{background:'rgba(255, 255, 255, 0.1)',borderRadius:'12px',color:'white','& .MuiOutlinedInput-notchedOutline':{borderColor:'rgba(255, 255, 255, 0.3)'},'&:hover .MuiOutlinedInput-notchedOutline':{borderColor:'rgba(255, 255, 255, 0.5)'},'&.Mui-focused .MuiOutlinedInput-notchedOutline':{borderColor:'#4ECDC4'},'& .MuiSelect-icon':{color:'rgba(255, 255, 255, 0.7)'}},onChange:e=>handleInputChange('category',e.target.value),disabled:!isHost||loading,label:\"Category\",children:categories.map(cat=>/*#__PURE__*/_jsx(MenuItem,{value:cat,children:cat},cat))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Description\",multiline:true,rows:3,value:settings.description,onChange:e=>handleInputChange('description',e.target.value),disabled:!isHost||loading,sx:{'& .MuiOutlinedInput-root':{background:'rgba(255, 255, 255, 0.1)',borderRadius:'12px','& fieldset':{borderColor:'rgba(255, 255, 255, 0.3)'},'&:hover fieldset':{borderColor:'rgba(255, 255, 255, 0.5)'},'&.Mui-focused fieldset':{borderColor:'#4ECDC4'}},'& .MuiInputLabel-root':{color:'rgba(255, 255, 255, 0.7)'},'& .MuiInputBase-input':{color:'white'}}})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Max Participants\",type:\"number\",value:settings.max_participants,onChange:e=>handleInputChange('max_participants',parseInt(e.target.value)),disabled:!isHost||loading,inputProps:{min:1,max:1000}})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",gutterBottom:true,sx:{display:'flex',alignItems:'center',gap:1,mt:2},children:[/*#__PURE__*/_jsx(Security,{}),\"Privacy & Access\"]}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:settings.is_public,onChange:e=>handleInputChange('is_public',e.target.checked),disabled:!isHost||loading}),label:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[settings.is_public?/*#__PURE__*/_jsx(Public,{}):/*#__PURE__*/_jsx(Lock,{}),settings.is_public?'Public Room':'Private Room']})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:settings.require_approval,onChange:e=>handleInputChange('require_approval',e.target.checked),disabled:!isHost||loading}),label:\"Require Approval to Join\"})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",gutterBottom:true,sx:{display:'flex',alignItems:'center',gap:1,mt:2},children:[/*#__PURE__*/_jsx(Chat,{}),\"Room Features\"]}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:settings.allow_chat,onChange:e=>handleInputChange('allow_chat',e.target.checked),disabled:!isHost||loading}),label:\"Enable Chat\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:settings.allow_reactions,onChange:e=>handleInputChange('allow_reactions',e.target.checked),disabled:!isHost||loading}),label:\"Enable Reactions\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:settings.mute_participants,onChange:e=>handleInputChange('mute_participants',e.target.checked),disabled:!isHost||loading}),label:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsx(VolumeOff,{}),\"Mute All Participants\"]})})}),isHost&&/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",gutterBottom:true,sx:{display:'flex',alignItems:'center',gap:1,mt:3,color:'error.main'},children:[/*#__PURE__*/_jsx(Warning,{}),\"Danger Zone\"]}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:2,flexWrap:'wrap'},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"warning\",startIcon:/*#__PURE__*/_jsx(Delete,{}),onClick:()=>{setDeleteType('soft');setShowDeleteConfirm(true);},disabled:loading,children:\"Close Room\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"error\",startIcon:/*#__PURE__*/_jsx(DeleteForever,{}),onClick:()=>{setDeleteType('permanent');setShowDeleteConfirm(true);},disabled:loading,children:\"Delete Permanently\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"text.secondary\",sx:{mt:1,display:'block'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Close Room:\"}),\" Marks room as inactive, can be reactivated later.\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:\"Delete Permanently:\"}),\" Completely removes the room and all data. This cannot be undone.\"]})]})]})]}),/*#__PURE__*/_jsxs(DialogActions,{sx:{padding:'24px',background:'rgba(255, 255, 255, 0.05)',borderTop:'1px solid rgba(255, 255, 255, 0.1)'},children:[/*#__PURE__*/_jsx(Button,{onClick:handleClose,disabled:loading,sx:{color:'rgba(255, 255, 255, 0.8)',borderRadius:'12px',textTransform:'none',fontWeight:'bold','&:hover':{background:'rgba(255, 255, 255, 0.1)'}},children:\"Cancel\"}),isHost&&/*#__PURE__*/_jsx(Button,{onClick:handleSaveSettings,variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Save,{}),disabled:loading||!settings.title.trim(),sx:{background:'linear-gradient(45deg, #4ECDC4, #44A08D)',borderRadius:'12px',textTransform:'none',fontWeight:'bold',px:3,'&:hover':{background:'linear-gradient(45deg, #44A08D, #4ECDC4)',transform:'translateY(-2px)',boxShadow:'0 8px 16px rgba(78, 205, 196, 0.3)'},'&:disabled':{background:'rgba(255, 255, 255, 0.1)',color:'rgba(255, 255, 255, 0.3)'},transition:'all 0.3s ease'},children:\"Save Settings\"})]}),/*#__PURE__*/_jsxs(Dialog,{open:showDeleteConfirm,onClose:()=>setShowDeleteConfirm(false),maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1,color:'error.main'},children:[/*#__PURE__*/_jsx(Warning,{}),\"Confirm \",deleteType==='permanent'?'Permanent Deletion':'Room Closure']})}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(Alert,{severity:\"warning\",sx:{mb:2},children:deleteType==='permanent'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"This will permanently delete the room and all associated data:\"}),/*#__PURE__*/_jsxs(\"ul\",{style:{margin:'8px 0',paddingLeft:'20px'},children:[/*#__PURE__*/_jsx(\"li\",{children:\"Room information and settings\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Chat messages and history\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Playlist and tracks\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Participant data\"})]}),/*#__PURE__*/_jsx(\"strong\",{children:\"This action cannot be undone!\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"This will close the room:\"}),/*#__PURE__*/_jsxs(\"ul\",{style:{margin:'8px 0',paddingLeft:'20px'},children:[/*#__PURE__*/_jsx(\"li\",{children:\"All participants will be removed\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Room will be marked as inactive\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Data will be preserved for potential reactivation\"})]})]})}),/*#__PURE__*/_jsxs(Typography,{children:[\"Are you sure you want to \",deleteType==='permanent'?'permanently delete':'close',\" the room \\\"\",room.title,\"\\\"?\"]})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setShowDeleteConfirm(false),disabled:loading,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleDeleteRoom,color:\"error\",variant:\"contained\",disabled:loading,startIcon:deleteType==='permanent'?/*#__PURE__*/_jsx(DeleteForever,{}):/*#__PURE__*/_jsx(Delete,{}),children:deleteType==='permanent'?'Delete Permanently':'Close Room'})]})]})]});};export default RoomSettings;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}