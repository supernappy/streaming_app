{"ast":null,"code":"import React,{useState,useEffect}from'react';import Dialog from'@mui/material/Dialog';import DialogTitle from'@mui/material/DialogTitle';import DialogContent from'@mui/material/DialogContent';import DialogActions from'@mui/material/DialogActions';import CircularProgress from'@mui/material/CircularProgress';import{Button,Box,Typography,Container,Grid,Card,CardContent,CardActions,Skeleton,Paper,Tooltip,IconButton,InputBase}from'@mui/material';import{PlayArrow,FavoriteBorder,CloudUpload,QueueMusic,Groups,TrendingUp,AccessTime,Search as SearchIcon,MusicNote,Movie}from'@mui/icons-material';import{tracksAPI,roomsAPI}from'../services/api';import{usePlayer}from'../contexts/PlayerContext';import{formatPlays}from'../utils/format';import{useAuth}from'../contexts/AuthContext';import{useNavigate}from'react-router-dom';import ModernRoomCard from'../components/ModernRoomCard';import TrackCard from'../components/TrackCard';import useSyncTrackCounts from'../hooks/useSyncTrackCounts';// Only one Home component and one export default should exist in this file. All duplicate declarations and exports have been removed.\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Home=()=>{const[tracksRaw,setTracksRaw]=useState([]);const[tracks,setTracks]=useSyncTrackCounts(tracksRaw);const[rooms,setRooms]=useState([]);const[loading,setLoading]=useState(true);const[tracksLoading,setTracksLoading]=useState(true);const[roomsLoading,setRoomsLoading]=useState(true);const{playTrack,incrementPlayCount,recentlyPlayed}=usePlayer?usePlayer():{playTrack:()=>{},incrementPlayCount:()=>{},recentlyPlayed:[]};// Modal state for AI Recommendations\nconst[aiModalOpen,setAiModalOpen]=useState(false);const[aiLoading,setAiLoading]=useState(false);const[aiPicks,setAiPicks]=useState([]);const[aiError,setAiError]=useState(null);// Fetch AI recommendations using shared axios instance for robust error handling\nconst fetchAIRecommendations=async()=>{setAiLoading(true);setAiError(null);try{if(!(user!==null&&user!==void 0&&user.id))throw new Error('You must be logged in for AI recommendations.');// Use shared axios instance (api.js)\nconst res=await import('../services/api').then(m=>m.default.get(`/ai/recommendations/${user.id}`));setAiPicks(res.data.recommendations||[]);}catch(err){// Axios error handling\nif(err.response){if(err.response.data&&err.response.data.error){setAiError(err.response.data.error);}else{setAiError(`Error: ${err.response.status} ${err.response.statusText}`);}}else if(err.request){setAiError('No response from server. Please check your network or backend.');}else{setAiError(err.message||'Unknown error');}}finally{setAiLoading(false);}};const{isAuthenticated,user}=useAuth();const navigate=useNavigate();useEffect(()=>{fetchData();},[]);const fetchData=async()=>{setLoading(true);await Promise.all([fetchTracks(),fetchRooms()]);setLoading(false);};const fetchTracks=async()=>{setTracksLoading(true);try{const response=await tracksAPI.getAll({limit:12,sort:'created_at'});setTracksRaw(response.data.tracks||[]);}catch(error){console.error('Error fetching tracks:',error);setTracks([]);}finally{setTracksLoading(false);}};const fetchRooms=async()=>{setRoomsLoading(true);try{const response=await roomsAPI.getAll({limit:6,is_active:true});setRooms(response.data.rooms||[]);}catch(error){console.error('Error fetching rooms:',error);setRooms([]);}finally{setRoomsLoading(false);}};const getWelcomeMessage=()=>{if(isAuthenticated&&user&&user.name){const hour=new Date().getHours();let greeting='Welcome';if(hour<12)greeting='Good morning';else if(hour<18)greeting='Good afternoon';else greeting='Good evening';return`${greeting}, ${user.name}!`;}return'Welcome to OpenStream!';};const handlePlay=track=>{playTrack(track,tracks);incrementPlayCount(track);};const handleLike=async trackId=>{if(!isAuthenticated){navigate('/login');return;}console.log('Like track:',trackId);};const handleJoinRoom=async roomId=>{if(!isAuthenticated){navigate('/login');return;}try{await roomsAPI.join(roomId);navigate(`/rooms/${roomId}`);}catch(error){var _error$response,_error$response2,_error$response$data,_error$response$data$;console.error('Error joining room:',error);let errorMessage='Failed to join room.';if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===404){errorMessage='Room not found or is no longer active.';}else if(((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)===400&&(_error$response$data=error.response.data)!==null&&_error$response$data!==void 0&&(_error$response$data$=_error$response$data.error)!==null&&_error$response$data$!==void 0&&_error$response$data$.includes('full')){errorMessage='This room is currently full.';}alert(errorMessage);}};const formatDuration=seconds=>{if(!seconds)return'--:--';const mins=Math.floor(seconds/60);const secs=seconds%60;return`${mins}:${secs.toString().padStart(2,'0')}`;};const LoadingSkeleton=_ref=>{let{count=8}=_ref;return/*#__PURE__*/_jsx(_Fragment,{children:Array.from({length:count}).map((_,index)=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,lg:3,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Skeleton,{variant:\"text\",width:\"80%\",height:32}),/*#__PURE__*/_jsx(Skeleton,{variant:\"text\",width:\"60%\",height:24}),/*#__PURE__*/_jsx(Skeleton,{variant:\"text\",width:\"40%\",height:24}),/*#__PURE__*/_jsx(Box,{sx:{mt:1},children:/*#__PURE__*/_jsx(Skeleton,{variant:\"rectangular\",width:60,height:24})})]}),/*#__PURE__*/_jsxs(CardActions,{children:[/*#__PURE__*/_jsx(Skeleton,{variant:\"circular\",width:40,height:40}),/*#__PURE__*/_jsx(Skeleton,{variant:\"circular\",width:40,height:40})]})]})},index))});};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",sx:{py:4,mb:10},children:[/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center',mb:6,position:'relative',overflow:'hidden',minHeight:280,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center'},children:[/*#__PURE__*/_jsx(Box,{sx:{position:'absolute',top:'-60px',left:'-60px',width:220,height:220,borderRadius:'50%',background:'radial-gradient(circle, #1DB954 60%, #1ed760 100%)',opacity:0.18,zIndex:0,animation:'float1 8s ease-in-out infinite'}}),/*#__PURE__*/_jsx(Box,{sx:{position:'absolute',bottom:'-80px',right:'-80px',width:300,height:300,borderRadius:'50%',background:'radial-gradient(circle, #1ed760 60%, #1DB954 100%)',opacity:0.13,zIndex:0,animation:'float2 10s ease-in-out infinite'}}),/*#__PURE__*/_jsx(\"style\",{children:`\n          @keyframes float1 {\n            0% { transform: translateY(0) scale(1); }\n            50% { transform: translateY(20px) scale(1.05); }\n            100% { transform: translateY(0) scale(1); }\n          }\n          @keyframes float2 {\n            0% { transform: translateY(0) scale(1); }\n            50% { transform: translateY(-18px) scale(1.04); }\n            100% { transform: translateY(0) scale(1); }\n          }\n        `}),/*#__PURE__*/_jsx(Typography,{variant:\"h2\",component:\"h1\",gutterBottom:true,sx:{fontWeight:'bold',background:'linear-gradient(45deg, #1DB954, #1ed760)',backgroundClip:'text',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'},children:\"Welcome to OpenStream\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",color:\"text.secondary\",paragraph:true,children:\"The open-source audio streaming platform built for creators\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",sx:{maxWidth:600,mx:'auto',mb:3},children:\"Stream music, create playlists, host live audio rooms, and connect with creators worldwide. All powered by open-source technology.\"}),!isAuthenticated&&/*#__PURE__*/_jsxs(Box,{sx:{mt:3},children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",size:\"large\",onClick:()=>navigate('/register'),sx:{mr:2,background:'linear-gradient(45deg, #1DB954, #1ed760)','&:hover':{background:'linear-gradient(45deg, #1ed760, #1DB954)'}},children:\"Get Started\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",size:\"large\",onClick:()=>navigate('/login'),children:\"Sign In\"})]})]}),/*#__PURE__*/_jsx(Box,{sx:{mb:4},children:/*#__PURE__*/_jsx(Typography,{variant:\"h3\",sx:{fontWeight:'bold'},children:getWelcomeMessage()})}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2,mb:6,textAlign:'left',px:{xs:1,sm:0}},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{fontWeight:'bold',mb:2},children:\"Featured Content\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:4,children:/*#__PURE__*/_jsxs(Card,{sx:{borderRadius:4,boxShadow:6,position:'relative',overflow:'hidden',minHeight:200,color:'white',background:'linear-gradient(135deg, #1DB954 60%, #1ed760 100%)',transition:'transform 0.25s cubic-bezier(.4,2,.6,1), box-shadow 0.25s','&:hover':{transform:'scale(1.04) translateY(-4px)',boxShadow:'0 12px 40px rgba(29,185,84,0.25)'}},children:[/*#__PURE__*/_jsx(Box,{sx:{position:'absolute',top:0,left:0,width:'100%',height:'100%',opacity:0.18,background:'url(https://img.icons8.com/color/96/000000/trend.png) center/60% no-repeat'}}),/*#__PURE__*/_jsxs(CardContent,{sx:{position:'relative',zIndex:1},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(TrendingUp,{sx:{fontSize:32,mr:1,color:'#fff'}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{fontWeight:'bold'},children:\"Trending Now\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{color:'rgba(255,255,255,0.85)'},children:\"Check out the hottest tracks and rooms right now.\"})]}),/*#__PURE__*/_jsx(CardActions,{sx:{position:'relative',zIndex:1},children:/*#__PURE__*/_jsx(Button,{size:\"medium\",variant:\"contained\",sx:{background:'rgba(0,0,0,0.18)',color:'white',fontWeight:600,borderRadius:2,'&:hover':{background:'rgba(0,0,0,0.28)'}},onClick:()=>navigate('/trending'),children:\"Explore\"})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:4,children:/*#__PURE__*/_jsxs(Card,{sx:{borderRadius:4,boxShadow:6,position:'relative',overflow:'hidden',minHeight:200,color:'white',background:'linear-gradient(135deg, #4ECDC4 60%, #556270 100%)',transition:'transform 0.25s cubic-bezier(.4,2,.6,1), box-shadow 0.25s','&:hover':{transform:'scale(1.04) translateY(-4px)',boxShadow:'0 12px 40px rgba(78,205,196,0.25)'}},children:[/*#__PURE__*/_jsx(Box,{sx:{position:'absolute',top:0,left:0,width:'100%',height:'100%',opacity:0.15,background:'url(https://img.icons8.com/color/96/000000/editor.png) center/60% no-repeat'}}),/*#__PURE__*/_jsxs(CardContent,{sx:{position:'relative',zIndex:1},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(QueueMusic,{sx:{fontSize:32,mr:1,color:'#fff'}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{fontWeight:'bold'},children:\"Editor\\u2019s Pick\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{color:'rgba(255,255,255,0.85)'},children:\"Handpicked content for you to explore.\"})]}),/*#__PURE__*/_jsx(CardActions,{sx:{position:'relative',zIndex:1},children:/*#__PURE__*/_jsx(Button,{size:\"medium\",variant:\"contained\",sx:{background:'rgba(0,0,0,0.18)',color:'white',fontWeight:600,borderRadius:2,'&:hover':{background:'rgba(0,0,0,0.28)'}},onClick:()=>navigate('/curated-playlist'),children:\"Explore\"})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:4,children:/*#__PURE__*/_jsxs(Card,{sx:{borderRadius:4,boxShadow:6,position:'relative',overflow:'hidden',minHeight:200,color:'white',background:'linear-gradient(135deg, #764ba2 60%, #667eea 100%)',transition:'transform 0.25s cubic-bezier(.4,2,.6,1), box-shadow 0.25s','&:hover':{transform:'scale(1.04) translateY(-4px)',boxShadow:'0 12px 40px rgba(118,75,162,0.25)'}},children:[/*#__PURE__*/_jsx(Box,{sx:{position:'absolute',top:0,left:0,width:'100%',height:'100%',opacity:0.15,background:'url(https://img.icons8.com/color/96/000000/artificial-intelligence.png) center/60% no-repeat'}}),/*#__PURE__*/_jsxs(CardContent,{sx:{position:'relative',zIndex:1},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(PlayArrow,{sx:{fontSize:32,mr:1,color:'#fff'}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{fontWeight:'bold'},children:\"AI Recommendation\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{color:'rgba(255,255,255,0.85)'},children:\"AI-powered picks based on your taste.\"})]}),/*#__PURE__*/_jsx(CardActions,{sx:{position:'relative',zIndex:1},children:/*#__PURE__*/_jsx(Button,{size:\"medium\",variant:\"contained\",sx:{background:'rgba(0,0,0,0.18)',color:'white',fontWeight:600,borderRadius:2,'&:hover':{background:'rgba(0,0,0,0.28)'}},onClick:()=>{setAiModalOpen(true);fetchAIRecommendations();},children:\"Explore\"})})]})}),/*#__PURE__*/_jsxs(Dialog,{open:aiModalOpen,onClose:()=>setAiModalOpen(false),maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"AI Recommendations\"}),/*#__PURE__*/_jsx(DialogContent,{children:aiLoading?/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',alignItems:'center',minHeight:120},children:/*#__PURE__*/_jsx(CircularProgress,{})}):aiError?/*#__PURE__*/_jsx(Typography,{color:\"error\",children:aiError}):aiPicks.length===0?/*#__PURE__*/_jsx(Typography,{children:\"No AI recommendations found.\"}):/*#__PURE__*/_jsx(Box,{children:aiPicks.map((track,idx)=>/*#__PURE__*/_jsxs(Box,{sx:{mb:2,p:2,borderRadius:2,bgcolor:'#23272f'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",children:typeof track.title==='object'?JSON.stringify(track.title):String(track.title)}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:typeof track.artist==='object'?JSON.stringify(track.artist):String(track.artist)}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:typeof track.reason==='object'?JSON.stringify(track.reason):String(track.reason||'')})]},track.id||idx))})}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsx(Button,{onClick:()=>setAiModalOpen(false),children:\"Close\"})})]})]})]}),/*#__PURE__*/_jsxs(Box,{sx:{mt:6,mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{fontWeight:'bold',mb:2},children:\"Active Rooms\"}),roomsLoading?/*#__PURE__*/_jsx(LoadingSkeleton,{count:6}):rooms.length===0?/*#__PURE__*/_jsx(Typography,{color:\"text.secondary\",children:\"No active rooms right now.\"}):/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:rooms.map(room=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsx(ModernRoomCard,{room:room,onJoin:()=>handleJoinRoom(room.id)})},room.id))})]}),/*#__PURE__*/_jsxs(Box,{sx:{mt:6,mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{fontWeight:'bold',mb:2},children:\"Latest Tracks\"}),tracksLoading?/*#__PURE__*/_jsx(LoadingSkeleton,{count:8}):tracks.length===0?/*#__PURE__*/_jsx(Typography,{color:\"text.secondary\",children:\"No tracks found.\"}):/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:tracks.map(track=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(TrackCard,{track:track,onPlay:()=>handlePlay(track),onFavorite:()=>handleLike(track.id)})},track.id))})]}),recentlyPlayed&&recentlyPlayed.length>0&&/*#__PURE__*/_jsxs(Box,{sx:{mt:6,mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{fontWeight:'bold',mb:2},children:\"Recently Played\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:recentlyPlayed.slice(0,8).map(track=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(TrackCard,{track:track,onPlay:()=>handlePlay(track),showActions:true})},track.id))})]}),!isAuthenticated&&/*#__PURE__*/_jsxs(Paper,{sx:{p:4,textAlign:'center',mt:6},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,sx:{fontWeight:'bold'},children:\"Ready to start your streaming journey?\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",sx:{mb:3},children:\"Join thousands of creators already using OpenStream\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",size:\"large\",startIcon:/*#__PURE__*/_jsx(CloudUpload,{}),onClick:()=>navigate('/register'),sx:{mr:2,background:'linear-gradient(45deg, #1DB954, #1ed760)','&:hover':{background:'linear-gradient(45deg, #1ed760, #1DB954)'}},children:\"Start Creating\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",size:\"large\",onClick:()=>navigate('/rooms'),children:\"Explore Rooms\"})]})]});};export default Home;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}