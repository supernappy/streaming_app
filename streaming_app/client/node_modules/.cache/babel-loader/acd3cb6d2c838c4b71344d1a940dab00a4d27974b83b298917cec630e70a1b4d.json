{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Container,Typography,Box,Paper,Avatar,Chip,IconButton,Skeleton,Button,AppBar,Toolbar,Badge,List,ListItem,ListItemAvatar,ListItemText,Divider,Dialog,DialogTitle,DialogContent,DialogActions,Alert,Grid,Tooltip}from'@mui/material';import{ArrowBack,Groups,Mic,MicOff,PanTool,RecordVoiceOver,VideoCall,Settings,ExitToApp,VolumeUp,VolumeOff,PersonAdd,Share,MoreVert,QueueMusic,Chat,MusicNote,Palette,Visibility}from'@mui/icons-material';import{styled}from'@mui/material/styles';import Grow from'@mui/material/Grow';// Animated status badge for online/active\nconst AnimatedBadge=styled(Badge)(_ref=>{let{theme,color}=_ref;return{'& .MuiBadge-badge':{background:color||theme.palette.success.main,color:color||theme.palette.success.main,boxShadow:`0 0 8px 2px ${color||theme.palette.success.main}`,animation:'pulse 1.2s infinite','@keyframes pulse':{'0%':{boxShadow:`0 0 0 0 ${color||theme.palette.success.main}`},'70%':{boxShadow:`0 0 0 8px rgba(0,0,0,0)`},'100%':{boxShadow:`0 0 0 0 ${color||theme.palette.success.main}`}}}};});import{useParams,useNavigate}from'react-router-dom';import{roomsAPI,tracksAPI}from'../services/api';import{useAuth}from'../contexts/AuthContext';import{usePlayer}from'../contexts/PlayerContext';import{useSocket}from'../contexts/SocketContext_enhanced';// Import enhanced audio player component\nimport RoomAudioPlayer_new from'../components/RoomAudioPlayer_new';import RoomChat from'../components/RoomChat';import RoomSettings from'../components/RoomSettings';import RoomThemes from'../components/RoomThemes';import AudioVisualizer from'../components/AudioVisualizer';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Room=()=>{const{recentlyPlayed}=usePlayer?usePlayer():{recentlyPlayed:[]};const{id}=useParams();const navigate=useNavigate();const{isAuthenticated,user}=useAuth();const{joinRoom,leaveRoom,participants:socketParticipants,roomState,isConnected,updateStatus,notifyTrackAdded}=useSocket();const[room,setRoom]=useState(null);const[loading,setLoading]=useState(true);const[roomError,setRoomError]=useState('');const[participants,setParticipants]=useState([]);const[roomTracks,setRoomTracks]=useState([]);const[userTracks,setUserTracks]=useState([]);const[isMuted,setIsMuted]=useState(false);const[handRaised,setHandRaised]=useState(false);const[showLeaveDialog,setShowLeaveDialog]=useState(false);const[showChat,setShowChat]=useState(false);const[showSettings,setShowSettings]=useState(false);const[currentTheme,setCurrentTheme]=useState('default');const[themeLoading,setThemeLoading]=useState(false);// Set initial theme from backend if available\nuseEffect(()=>{if(room&&room.background_theme){setCurrentTheme(room.background_theme);}},[room]);// Handler to update theme both locally and in backend\nconst handleThemeChange=async themeKey=>{setThemeLoading(true);setCurrentTheme(themeKey);try{await roomsAPI.updateSettings(id,{background_theme:themeKey});setRoom(prev=>prev?{...prev,background_theme:themeKey}:prev);}catch(err){// Optionally show error to user\nalert('Failed to update theme.');}finally{setThemeLoading(false);}};const[showVisualizer,setShowVisualizer]=useState(true);const[visualizerType,setVisualizerType]=useState('bars');const[isHost,setIsHost]=useState(false);useEffect(()=>{if(!isAuthenticated){navigate('/login');return;}fetchRoom();fetchParticipants();fetchRoomTracks();fetchUserTracks();},[id,isAuthenticated]);useEffect(()=>{if(room&&user){const hostStatus=room.host_id===user.id;console.log('=== DEBUG: Host status check ===');console.log('Room:',room);console.log('Room host_id:',room.host_id);console.log('Current user:',user);console.log('Current user ID:',user.id);console.log('Is host:',hostStatus);console.log('User ID type:',typeof user.id);console.log('Host ID type:',typeof room.host_id);setIsHost(hostStatus);// Join the room via API (to be added to participants table)\nif(!hostStatus){// Non-hosts need to join the room as participants\nroomsAPI.join(id).then(response=>{console.log('Successfully joined room as participant:',response);}).catch(error=>{var _error$response;console.error('Failed to join room:',error);// Check if it's because already joined\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)!==409){console.warn('Unexpected error joining room, but continuing...');}});}// Join the room via WebSocket\nif(isConnected){console.log('Joining room via WebSocket:',id,user);joinRoom(id,user);}}},[room,user,isConnected,id,joinRoom]);// Sync participants with WebSocket\nuseEffect(()=>{if(socketParticipants.length>0){setParticipants(socketParticipants);}},[socketParticipants]);// Sync room state with WebSocket\nuseEffect(()=>{if(roomState){setRoom(roomState);}},[roomState]);const fetchRoom=async()=>{try{const response=await roomsAPI.getById(id);console.log('[Room.js] fetchRoom response:',response);setRoom(response.data.room);setRoomError('');}catch(error){console.error('[Room.js] Error fetching room:',error);setRoomError('Failed to load room data. Please check your backend/API and try again.');}finally{setLoading(false);}};const fetchParticipants=async()=>{try{const response=await roomsAPI.getParticipants(id);setParticipants(response.data.participants||[]);}catch(error){console.error('Error fetching participants:',error);}};const fetchRoomTracks=async()=>{try{console.log('=== DEBUG: Fetching room tracks ===');console.log('Room ID:',id);const response=await roomsAPI.getTracks(id);console.log('Room tracks response:',response.data);console.log('Room tracks array:',response.data.tracks);setRoomTracks(response.data.tracks||[]);console.log('Room tracks set, length:',(response.data.tracks||[]).length);}catch(error){console.error('Error fetching room tracks:',error);setRoomTracks([]);// Set empty array on error\n}};const fetchUserTracks=async()=>{try{const response=await tracksAPI.getUserTracks();setUserTracks(response.data.tracks||[]);}catch(error){console.error('Error fetching user tracks:',error);}};const handleLeaveRoom=async()=>{try{leaveRoom();// Leave WebSocket room\nawait roomsAPI.leave(id);navigate('/rooms');}catch(error){console.error('Error leaving room:',error);alert('Failed to leave room. Please try again.');}};const handleMuteToggle=()=>{const newMutedState=!isMuted;setIsMuted(newMutedState);updateStatus({isMuted:newMutedState});};const handleRaiseHand=()=>{console.log('handleRaiseHand clicked, current handRaised:',handRaised);console.log('isConnected:',isConnected);console.log('currentRoom:',roomState);const newHandState=!handRaised;console.log('newHandState:',newHandState);setHandRaised(newHandState);updateStatus({handRaised:newHandState});console.log('updateStatus called with:',{handRaised:newHandState});};const handleAddTrackToRoom=async track=>{try{console.log('=== DEBUG: Room handleAddTrackToRoom ===');console.log('Room ID:',id);console.log('Track to add:',track);console.log('Track ID:',track.id);console.log('User:',user);console.log('Is authenticated:',isAuthenticated);if(!track||!track.id){throw new Error('Invalid track: missing track or track ID');}if(!id){throw new Error('Invalid room: missing room ID');}console.log('Making API call to add track...');const response=await roomsAPI.addTrack(id,track.id);console.log('API response:',response);setRoomTracks(prev=>{const updated=[...prev,track];console.log('Updated room tracks:',updated);return updated;});notifyTrackAdded(track);// Notify via WebSocket\nconsole.log('=== DEBUG: Track added successfully to room ===');console.log('Track title:',track.title);}catch(error){var _error$response2,_error$response3,_error$response4,_error$response5,_error$response6;console.error('=== DEBUG: Error in handleAddTrackToRoom ===');console.error('Error object:',error);console.error('Error message:',error.message);console.error('Error response:',(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data);console.error('Error status:',(_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status);// Show user-friendly error message\nif(((_error$response4=error.response)===null||_error$response4===void 0?void 0:_error$response4.status)===403){alert('You do not have permission to add tracks to this room. Make sure you are a participant.');}else if(((_error$response5=error.response)===null||_error$response5===void 0?void 0:_error$response5.status)===404){alert('Track or room not found. Please refresh and try again.');}else if(((_error$response6=error.response)===null||_error$response6===void 0?void 0:_error$response6.status)===409){alert('This track is already in the room. You cannot add the same track twice.');}else{var _error$response7,_error$response7$data;alert(`Failed to add track to room: ${((_error$response7=error.response)===null||_error$response7===void 0?void 0:(_error$response7$data=_error$response7.data)===null||_error$response7$data===void 0?void 0:_error$response7$data.error)||error.message}`);}// Re-throw so the component can handle it too\nthrow error;}};const handleRemoveTrackFromRoom=async track=>{try{console.log('=== DEBUG: Room handleRemoveTrackFromRoom ===');console.log('Room ID:',id);console.log('Track to remove:',track);console.log('Track ID:',track.id);console.log('User:',user);console.log('Is authenticated:',isAuthenticated);if(!track||!track.id){throw new Error('Invalid track: missing track or track ID');}if(!id){throw new Error('Invalid room: missing room ID');}// Show confirmation dialog\nconst confirmed=window.confirm(`Are you sure you want to remove \"${track.title}\" from this room?`);if(!confirmed){return;}console.log('Making API call to remove track...');const response=await roomsAPI.removeTrack(id,track.id);console.log('API response:',response);// Update local state\nsetRoomTracks(prev=>{const updated=prev.filter(t=>t.id!==track.id);console.log('Updated room tracks after removal:',updated);return updated;});console.log('=== DEBUG: Track removed successfully from room ===');console.log('Track title:',track.title);}catch(error){var _error$response8,_error$response9,_error$response0,_error$response1;console.error('=== DEBUG: Error in handleRemoveTrackFromRoom ===');console.error('Error object:',error);console.error('Error message:',error.message);console.error('Error response:',(_error$response8=error.response)===null||_error$response8===void 0?void 0:_error$response8.data);console.error('Error status:',(_error$response9=error.response)===null||_error$response9===void 0?void 0:_error$response9.status);// Show user-friendly error message\nif(((_error$response0=error.response)===null||_error$response0===void 0?void 0:_error$response0.status)===403){alert('You do not have permission to remove tracks from this room.');}else if(((_error$response1=error.response)===null||_error$response1===void 0?void 0:_error$response1.status)===404){alert('Track not found in room or room not found.');}else{var _error$response10,_error$response10$dat;alert(`Failed to remove track from room: ${((_error$response10=error.response)===null||_error$response10===void 0?void 0:(_error$response10$dat=_error$response10.data)===null||_error$response10$dat===void 0?void 0:_error$response10$dat.error)||error.message}`);}}};const handleRoomUpdated=updatedRoom=>{setRoom(updatedRoom);console.log('Room updated:',updatedRoom.title);};const handleRoomDeleted=(roomId,isPermanent)=>{console.log('Room deleted:',roomId,'permanent:',isPermanent);// Navigate back to rooms list\nnavigate('/rooms');};if(loading){return/*#__PURE__*/_jsx(Container,{maxWidth:\"lg\",sx:{py:4,mb:10},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:4},children:[/*#__PURE__*/_jsx(Skeleton,{variant:\"text\",width:\"30%\",height:40}),/*#__PURE__*/_jsx(Skeleton,{variant:\"text\",width:\"50%\",height:24,sx:{mt:2}}),/*#__PURE__*/_jsx(Box,{sx:{mt:4},children:/*#__PURE__*/_jsx(Skeleton,{variant:\"rectangular\",height:200})})]})});}if(roomError){return/*#__PURE__*/_jsx(Container,{maxWidth:\"sm\",sx:{py:8},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:4,textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",color:\"error\",gutterBottom:true,children:roomError}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",children:\"Try refreshing the page or check your backend/API logs for errors.\"})]})});}return/*#__PURE__*/_jsxs(Box,{sx:{minHeight:'100vh',pb:2,transition:'background 0.5s',background:(()=>{// Map theme keys to backgrounds (sync with RoomThemes.js)\nswitch(currentTheme){case'light':return'#fff';case'dark':return'#222';case'aqua':return'#4ecdc4';case'sunset':return'linear-gradient(135deg, #ff9966 0%, #ff5e62 100%)';case'forest':return'#228B22';case'midnight':return'linear-gradient(135deg, #232526 0%, #414345 100%)';case'lavender':return'#b57edc';case'peach':return'#ffdab9';case'ocean':return'linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%)';case'rose':return'#ffb6c1';case'space':return'linear-gradient(135deg, #0f2027 0%, #2c5364 100%)';default:return'linear-gradient(135deg, #232526 0%, #414345 100%)';}})()},children:[/*#__PURE__*/_jsx(RoomThemes,{theme:currentTheme,onThemeChange:handleThemeChange,loading:themeLoading}),/*#__PURE__*/_jsx(AppBar,{position:\"sticky\",sx:{background:'rgba(255,255,255,0.20)',backdropFilter:'blur(18px) saturate(180%)',boxShadow:'0 8px 32px 0 rgba(31, 38, 135, 0.10)',borderBottom:'1px solid rgba(255,255,255,0.18)',borderTopLeftRadius:0,borderTopRightRadius:0,zIndex:10},children:/*#__PURE__*/_jsxs(Toolbar,{sx:{minHeight:72,px:2},children:[/*#__PURE__*/_jsx(IconButton,{onClick:()=>navigate('/rooms'),sx:{mr:2,color:'white'},children:/*#__PURE__*/_jsx(ArrowBack,{})}),/*#__PURE__*/_jsxs(Box,{sx:{flexGrow:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{fontWeight:'bold',color:'white'},children:(room===null||room===void 0?void 0:room.title)||`Room ${id}`}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{color:'rgba(255,255,255,0.7)'},children:[\"Host: \",room===null||room===void 0?void 0:room.host_username,\" \\u2022 \",participants.length,\" participants\"]})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsx(Chip,{label:room!==null&&room!==void 0&&room.is_active?'Live':'Inactive',color:room!==null&&room!==void 0&&room.is_active?'success':'default',size:\"small\"}),/*#__PURE__*/_jsx(IconButton,{onClick:handleMuteToggle,sx:{color:isMuted?'#ff4444':'white',backgroundColor:isMuted?'rgba(255, 68, 68, 0.1)':'transparent'},children:isMuted?/*#__PURE__*/_jsx(MicOff,{}):/*#__PURE__*/_jsx(Mic,{})}),/*#__PURE__*/_jsx(IconButton,{onClick:handleRaiseHand,sx:{color:handRaised?'#1DB954':'white',backgroundColor:handRaised?'rgba(29, 185, 84, 0.1)':'transparent'},children:/*#__PURE__*/_jsx(PanTool,{})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Toggle Visualizer\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>setShowVisualizer(!showVisualizer),sx:{color:showVisualizer?'#1DB954':'white',backgroundColor:showVisualizer?'rgba(29, 185, 84, 0.1)':'transparent'},children:/*#__PURE__*/_jsx(Visibility,{})})}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>setShowLeaveDialog(true),sx:{color:'#ff4444'},children:/*#__PURE__*/_jsx(ExitToApp,{})})]})]})}),/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",sx:{py:3},children:[/*#__PURE__*/_jsx(Paper,{sx:{p:3,mb:3,background:'rgba(255, 255, 255, 0.1)',backdropFilter:'blur(20px)',borderRadius:3,border:'1px solid rgba(255, 255, 255, 0.2)'},children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Avatar,{sx:{width:60,height:60,backgroundColor:'#1DB954',mr:3},children:/*#__PURE__*/_jsx(RecordVoiceOver,{sx:{fontSize:30}})}),/*#__PURE__*/_jsxs(Box,{sx:{flexGrow:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{fontWeight:'bold',color:'white'},children:room===null||room===void 0?void 0:room.title}),(room===null||room===void 0?void 0:room.description)&&/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{color:'rgba(255,255,255,0.8)',mt:1},children:room.description}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1,mt:2},children:[(room===null||room===void 0?void 0:room.category)&&/*#__PURE__*/_jsx(Chip,{label:room.category,size:\"small\",variant:\"outlined\",sx:{color:'white'}}),(room===null||room===void 0?void 0:room.mood)&&/*#__PURE__*/_jsx(Chip,{label:room.mood,size:\"small\",variant:\"outlined\",sx:{color:'white'}})]})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:2},children:[/*#__PURE__*/_jsx(Badge,{badgeContent:participants.length,color:\"primary\",children:/*#__PURE__*/_jsx(Groups,{sx:{color:'white'}})}),/*#__PURE__*/_jsx(IconButton,{sx:{color:showChat?'primary.main':'white'},onClick:()=>setShowChat(!showChat),children:/*#__PURE__*/_jsx(Chat,{})}),/*#__PURE__*/_jsx(IconButton,{sx:{color:'white'},children:/*#__PURE__*/_jsx(Share,{})}),isHost&&/*#__PURE__*/_jsx(IconButton,{sx:{color:'white'},onClick:()=>setShowSettings(true),title:\"Room Settings\",children:/*#__PURE__*/_jsx(Settings,{})})]})]})}),showVisualizer&&roomTracks.length>0&&/*#__PURE__*/_jsx(Paper,{sx:{p:2,mb:3,background:'rgba(255, 255, 255, 0.1)',backdropFilter:'blur(20px)',borderRadius:3,border:'1px solid rgba(255, 255, 255, 0.2)'},children:/*#__PURE__*/_jsx(AudioVisualizer,{type:visualizerType,theme:currentTheme})}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,lg:showChat?8:12,children:[roomTracks&&roomTracks.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(RoomAudioPlayer_new,{room:room,isHost:isHost,tracks:roomTracks,onAddTrack:handleAddTrackToRoom,onRemoveTrack:handleRemoveTrackFromRoom}),/*#__PURE__*/_jsxs(Box,{sx:{mt:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{color:'white',mb:2},children:\"Room Track List\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:roomTracks.map(track=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsx(Tooltip,{title:track.play_count===1?'Played once':`Played ${track.play_count||0} times`,arrow:true,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2,bgcolor:'#23272f',color:'white',display:'flex',alignItems:'center',gap:2},children:[/*#__PURE__*/_jsx(Avatar,{src:track.cover_url||'/default_cover.png',alt:track.title,sx:{width:56,height:56,mr:2,bgcolor:'grey.800',flexShrink:0},variant:\"rounded\",children:/*#__PURE__*/_jsx(MusicNote,{})}),/*#__PURE__*/_jsxs(Box,{sx:{flexGrow:1,minWidth:0},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",noWrap:true,children:track.title}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"#aaa\",noWrap:true,children:track.artist}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"#aaa\",children:[\"Plays: \",track.play_count||0]})]})]})})},track.id))})]})]}):/*#__PURE__*/_jsx(Paper,{elevation:3,sx:{p:3},children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center',py:4},children:[/*#__PURE__*/_jsx(MusicNote,{sx:{fontSize:64,color:'text.secondary',mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"text.secondary\",children:\"No tracks in this room\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:isHost?'Add some tracks to get started!':'Waiting for host to add tracks...'})]})}),recentlyPlayed&&recentlyPlayed.length>0&&/*#__PURE__*/_jsxs(Box,{sx:{mt:6,mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{fontWeight:'bold',mb:2,color:'white'},children:\"Recently Played\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:recentlyPlayed.slice(0,8).map(track=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Tooltip,{title:track.play_count===1?'Played once':`Played ${track.play_count||0} times`,arrow:true,children:/*#__PURE__*/_jsxs(Paper,{sx:{bgcolor:'#23272f',color:'white',p:2,display:'flex',alignItems:'center',gap:2},children:[/*#__PURE__*/_jsx(Avatar,{src:track.cover_url||'/default_cover.png',alt:track.title,sx:{width:48,height:48,mr:2,bgcolor:'grey.800',flexShrink:0},variant:\"rounded\",children:/*#__PURE__*/_jsx(MusicNote,{})}),/*#__PURE__*/_jsxs(Box,{sx:{flexGrow:1,minWidth:0},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",noWrap:true,children:track.title}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"#aaa\",noWrap:true,children:track.artist}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"#aaa\",children:[\"Plays: \",track.play_count||0]})]})]})})},track.id))})]}),/*#__PURE__*/_jsx(Box,{sx:{mt:8,mb:4},children:/*#__PURE__*/_jsx(Typography,{variant:\"h4\",sx:{fontWeight:'bold',mb:2,color:'white'},children:\"AI Picks For This Room\"})}),isHost&&/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3,mt:3,background:'rgba(255, 255, 255, 0.1)',backdropFilter:'blur(20px)',borderRadius:3,border:'1px solid rgba(255, 255, 255, 0.2)'},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",sx:{mb:2,color:'white',display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(QueueMusic,{sx:{mr:1}}),\"Add Tracks to Room\",/*#__PURE__*/_jsx(Chip,{label:`${userTracks.length} available`,size:\"small\",sx:{ml:2,backgroundColor:'rgba(255,255,255,0.2)',color:'white'}})]}),userTracks.length===0?/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center',py:3},children:[/*#__PURE__*/_jsx(MusicNote,{sx:{fontSize:48,color:'rgba(255,255,255,0.5)',mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{color:'rgba(255,255,255,0.8)',mb:2},children:\"You don't have any tracks yet\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:()=>navigate('/upload'),startIcon:/*#__PURE__*/_jsx(MusicNote,{}),children:\"Upload Your First Track\"})]}):/*#__PURE__*/_jsx(Box,{sx:{maxHeight:300,overflowY:'auto'},children:userTracks.map(track=>{const isAlreadyInRoom=roomTracks.some(rt=>rt.id===track.id);return/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',p:2,mb:1,borderRadius:2,backgroundColor:isAlreadyInRoom?'rgba(76, 175, 80, 0.1)':'rgba(255, 255, 255, 0.05)',border:isAlreadyInRoom?'1px solid rgba(76, 175, 80, 0.3)':'1px solid rgba(255, 255, 255, 0.1)',transition:'all 0.2s ease','&:hover':!isAlreadyInRoom?{backgroundColor:'rgba(255, 255, 255, 0.1)',transform:'translateX(4px)'}:{}},children:[/*#__PURE__*/_jsx(Avatar,{sx:{width:50,height:50,mr:2,backgroundColor:'primary.main'},children:/*#__PURE__*/_jsx(MusicNote,{})}),/*#__PURE__*/_jsxs(Box,{sx:{flexGrow:1,minWidth:0},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",sx:{color:'white',fontWeight:'bold',textOverflow:'ellipsis',overflow:'hidden',whiteSpace:'nowrap'},children:track.title}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{color:'rgba(255,255,255,0.7)',textOverflow:'ellipsis',overflow:'hidden',whiteSpace:'nowrap'},children:track.artist}),track.duration&&/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",sx:{color:'rgba(255,255,255,0.5)'},children:[\"Duration: \",Math.floor(track.duration/60),\":\",(track.duration%60).toString().padStart(2,'0')]})]}),isAlreadyInRoom?/*#__PURE__*/_jsx(Chip,{label:\"In Room\",color:\"success\",size:\"small\",icon:/*#__PURE__*/_jsx(MusicNote,{}),sx:{mr:1}}):/*#__PURE__*/_jsx(Tooltip,{title:\"Add this track to the room\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",size:\"small\",onClick:()=>handleAddTrackToRoom(track),startIcon:/*#__PURE__*/_jsx(QueueMusic,{}),sx:{minWidth:100,'&:hover':{backgroundColor:'primary.dark',transform:'scale(1.05)'}},children:\"Add\"})})]},track.id);})})]}),/*#__PURE__*/_jsxs(Paper,{sx:{p:3,mt:3,background:'rgba(255, 255, 255, 0.1)',backdropFilter:'blur(20px)',borderRadius:3,border:'1px solid rgba(255, 255, 255, 0.2)'},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",sx:{mb:2,color:'white',display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Groups,{sx:{mr:1}}),\"Participants (\",participants.length,\")\",isHost&&/*#__PURE__*/_jsx(Button,{size:\"small\",startIcon:/*#__PURE__*/_jsx(PersonAdd,{}),sx:{ml:'auto',color:'#1DB954'},children:\"Invite\"})]}),/*#__PURE__*/_jsxs(List,{children:[participants.map((participant,index)=>{var _participant$username;return/*#__PURE__*/_jsx(Grow,{in:true,timeout:400+index*80,children:/*#__PURE__*/_jsxs(ListItem,{divider:index<participants.length-1,sx:{transition:'background 0.3s'},children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(AnimatedBadge,{overlap:\"circular\",anchorOrigin:{vertical:'bottom',horizontal:'right'},variant:\"dot\",color:participant.is_muted?'warning':participant.hand_raised?'secondary':'success',children:/*#__PURE__*/_jsx(Avatar,{src:participant.avatar_url,children:(_participant$username=participant.username)===null||_participant$username===void 0?void 0:_participant$username.charAt(0).toUpperCase()})})}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsx(Typography,{sx:{color:'white'},children:participant.display_name||participant.username}),participant.id===(room===null||room===void 0?void 0:room.host_id)&&/*#__PURE__*/_jsx(Chip,{label:\"Host\",size:\"small\",color:\"primary\"}),participant.role==='speaker'&&/*#__PURE__*/_jsx(Chip,{label:\"Speaker\",size:\"small\",variant:\"outlined\"}),participant.is_muted&&/*#__PURE__*/_jsx(Chip,{label:\"Muted\",size:\"small\",color:\"warning\",sx:{ml:1,animation:'shake 0.7s infinite alternate'}}),participant.hand_raised&&/*#__PURE__*/_jsx(Chip,{label:\"Hand Raised\",size:\"small\",color:\"secondary\",sx:{ml:1,animation:'bounce 1s infinite alternate'}})]}),secondary:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{color:'rgba(255,255,255,0.6)'},children:[participant.is_muted?'Muted':'Speaking',\" \\u2022\",participant.hand_raised?' Hand raised':' Listening']})}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[participant.is_muted?/*#__PURE__*/_jsx(VolumeOff,{color:\"disabled\"}):/*#__PURE__*/_jsx(VolumeUp,{color:\"primary\"}),participant.hand_raised&&/*#__PURE__*/_jsx(PanTool,{color:\"warning\"})]})]})},participant.id);}),participants.length===0&&/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsx(Typography,{sx:{color:'rgba(255,255,255,0.6)',textAlign:'center'},children:\"No participants yet\"})})})]})]})]}),showChat&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,lg:4,children:/*#__PURE__*/_jsx(Box,{sx:{height:'600px'},children:/*#__PURE__*/_jsx(RoomChat,{room:room})})})]}),/*#__PURE__*/_jsxs(Dialog,{open:showLeaveDialog,onClose:()=>setShowLeaveDialog(false),PaperProps:{sx:{background:'linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(50, 50, 50, 0.95) 100%)',backdropFilter:'blur(20px)',border:'1px solid rgba(255, 255, 255, 0.1)'}},children:[/*#__PURE__*/_jsx(DialogTitle,{sx:{color:'white'},children:\"Leave Room\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(Alert,{severity:\"warning\",sx:{mb:2},children:\"Are you sure you want to leave this room?\"}),/*#__PURE__*/_jsxs(Typography,{sx:{color:'rgba(255,255,255,0.8)'},children:[\"You can rejoin this room anytime if it's still active.\",isHost&&/*#__PURE__*/_jsx(Typography,{component:\"span\",sx:{color:'#ff4444',fontWeight:'bold',display:'block',mt:1},children:\"Warning: As the host, leaving will end the room for all participants.\"})]})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setShowLeaveDialog(false),sx:{color:'rgba(255,255,255,0.7)'},children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleLeaveRoom,variant:\"contained\",color:\"error\",startIcon:/*#__PURE__*/_jsx(ExitToApp,{}),children:isHost?'End Room':'Leave Room'})]})]}),/*#__PURE__*/_jsx(RoomSettings,{open:showSettings,onClose:()=>setShowSettings(false),room:room,isHost:isHost,onRoomUpdated:handleRoomUpdated,onRoomDeleted:handleRoomDeleted})]})]});};export default Room;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}