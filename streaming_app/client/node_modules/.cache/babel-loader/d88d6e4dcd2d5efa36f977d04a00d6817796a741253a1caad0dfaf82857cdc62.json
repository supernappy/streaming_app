{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Container,Typography,Grid,Card,CardContent,Box,Tabs,Tab,IconButton,Chip}from'@mui/material';import{PlayArrow,Person,Album,MusicNote}from'@mui/icons-material';import{useSearchParams}from'react-router-dom';import axios from'axios';import{usePlayer}from'../contexts/PlayerContext';import Tooltip from'@mui/material/Tooltip';import AudioPlayer from'../components/AudioPlayer';import{formatNumberCompact}from'../utils/format';import useSyncTrackCounts from'../hooks/useSyncTrackCounts';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Search=()=>{var _results$artists,_results$albums;const[searchParams]=useSearchParams();const query=searchParams.get('q');const[results,setResults]=useState({tracks:[],artists:[],albums:[]});const[syncedTracks,setSyncedTracks]=useSyncTrackCounts(results.tracks);const[loading,setLoading]=useState(false);const[activeTab,setActiveTab]=useState(0);const{playTrack,recentlyPlayed}=usePlayer?usePlayer():{playTrack:()=>{},recentlyPlayed:[]};useEffect(()=>{if(query){performSearch(query);}},[query]);const performSearch=async searchQuery=>{setLoading(true);try{const response=await axios.get(`/api/search?q=${encodeURIComponent(searchQuery)}`);// Debug: log the full raw response from backend\nif(window&&window.localStorage){window.localStorage.setItem('search_raw_response',JSON.stringify(response.data));}console.log('DEBUG: Raw backend response:',response.data);const newResults=response.data.results||{};setResults({tracks:Array.isArray(newResults.tracks)?newResults.tracks:[],artists:Array.isArray(newResults.artists)?newResults.artists:[],albums:Array.isArray(newResults.albums)?newResults.albums:[]});}catch(error){console.error('Search error:',error);setResults({tracks:[],artists:[],albums:[]});}finally{setLoading(false);}};const handleTabChange=(event,newValue)=>{setActiveTab(newValue);};const handlePlayTrack=track=>{const trackList=syncedTracks||[];playTrack(track,trackList);};if(!query){return/*#__PURE__*/_jsx(Container,{sx:{py:4,textAlign:'center'},children:/*#__PURE__*/_jsx(Typography,{variant:\"h5\",color:\"text.secondary\",children:\"Enter a search term to find music\"})});}if(loading){return/*#__PURE__*/_jsx(Container,{sx:{py:4},children:/*#__PURE__*/_jsxs(Typography,{children:[\"Searching for \\\"\",query,\"\\\"...\"]})});}const tabs=[{label:'All',icon:/*#__PURE__*/_jsx(MusicNote,{})},{label:`Tracks (${(syncedTracks===null||syncedTracks===void 0?void 0:syncedTracks.length)||0})`,icon:/*#__PURE__*/_jsx(MusicNote,{})},{label:`Artists (${((_results$artists=results.artists)===null||_results$artists===void 0?void 0:_results$artists.length)||0})`,icon:/*#__PURE__*/_jsx(Person,{})},{label:`Albums (${((_results$albums=results.albums)===null||_results$albums===void 0?void 0:_results$albums.length)||0})`,icon:/*#__PURE__*/_jsx(Album,{})}];return/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",sx:{py:4,mb:10},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",gutterBottom:true,sx:{fontWeight:'bold'},children:[\"Search Results for \\\"\",query,\"\\\"\"]}),/*#__PURE__*/_jsx(Box,{sx:{borderBottom:1,borderColor:'divider',mb:3},children:/*#__PURE__*/_jsx(Tabs,{value:activeTab,onChange:handleTabChange,children:tabs.map((tab,index)=>/*#__PURE__*/_jsx(Tab,{label:tab.label,icon:tab.icon,iconPosition:\"start\"},index))})}),activeTab===0&&/*#__PURE__*/_jsxs(Box,{children:[syncedTracks&&syncedTracks.length>0&&/*#__PURE__*/_jsxs(Box,{sx:{mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,sx:{fontWeight:'bold'},children:\"Tracks\"}),/*#__PURE__*/_jsx(Box,{sx:{display:'flex',flexDirection:'column',gap:2},children:syncedTracks.slice(0,6).map(track=>track.file_url&&track.file_url.toLowerCase().endsWith('.mp4')?/*#__PURE__*/_jsx(Card,{sx:{backgroundColor:'#1e1e1e',color:'white',mb:2},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",children:track.title}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:track.artist}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:\"Video\"}),/*#__PURE__*/_jsx(Box,{sx:{mt:1},children:/*#__PURE__*/_jsx(\"video\",{src:track.file_url,controls:true,style:{width:'100%',maxWidth:320,borderRadius:8}})})]})},track.id):/*#__PURE__*/_jsx(Tooltip,{title:track.play_count===1?'Played once':`Played ${track.play_count||0} times`,arrow:true,children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(AudioPlayer,{track:track,onPlay:track=>handlePlayTrack(track),compact:true})})},track.id))})]}),results.artists&&results.artists.length>0&&/*#__PURE__*/_jsxs(Box,{sx:{mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,sx:{fontWeight:'bold'},children:\"Artists\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:results.artists.slice(0,4).map((artist,index)=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{sx:{backgroundColor:'#1e1e1e',textAlign:'center'},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Person,{sx:{fontSize:48,color:'#1DB954',mb:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:artist.artist}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[artist.track_count,\" tracks \\u2022 \",formatNumberCompact(artist.total_plays),\" plays\"]})]})})},index))})]})]}),activeTab===1&&/*#__PURE__*/_jsx(Box,{sx:{display:'flex',flexDirection:'column',gap:2},children:syncedTracks&&syncedTracks.length>0?syncedTracks.map(track=>track.file_url&&track.file_url.toLowerCase().endsWith('.mp4')?/*#__PURE__*/_jsx(Card,{sx:{backgroundColor:'#1e1e1e',color:'white',mb:2},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",children:track.title}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:track.artist}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:\"Video\"}),/*#__PURE__*/_jsx(Box,{sx:{mt:1},children:/*#__PURE__*/_jsx(\"video\",{src:track.file_url,controls:true,style:{width:'100%',maxWidth:320,borderRadius:8}})})]})},track.id):/*#__PURE__*/_jsx(Tooltip,{title:track.play_count===1?'Played once':`Played ${track.play_count||0} times`,arrow:true,children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(AudioPlayer,{track:track,onPlay:track=>handlePlayTrack(track),compact:true})})},track.id)):/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",color:\"text.secondary\",sx:{textAlign:'center',py:4},children:[\"No tracks found for \\\"\",query,\"\\\"\"]})}),activeTab===2&&/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:results.artists&&results.artists.length>0?results.artists.map((artist,index)=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsx(Card,{sx:{backgroundColor:'#1e1e1e',textAlign:'center'},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Person,{sx:{fontSize:64,color:'#1DB954',mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:artist.artist}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[artist.track_count,\" tracks\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[formatNumberCompact(artist.total_plays),\" total plays\"]})]})})},index)):/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",color:\"text.secondary\",sx:{textAlign:'center'},children:[\"No artists found for \\\"\",query,\"\\\"\"]})})}),activeTab===3&&/*#__PURE__*/_jsx(Grid,{container:true,spacing:3,children:results.albums&&results.albums.length>0?results.albums.map((album,index)=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsx(Card,{sx:{backgroundColor:'#1e1e1e'},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Album,{sx:{fontSize:48,color:'#1DB954',mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:album.album}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"by \",album.artist]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[album.track_count,\" tracks \\u2022 \",formatNumberCompact(album.total_plays),\" plays\"]})]})})},index)):/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",color:\"text.secondary\",sx:{textAlign:'center'},children:[\"No albums found for \\\"\",query,\"\\\"\"]})})}),recentlyPlayed&&recentlyPlayed.length>0&&/*#__PURE__*/_jsxs(Box,{sx:{mt:6,mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{fontWeight:'bold',mb:2},children:\"Recently Played\"}),/*#__PURE__*/_jsx(Box,{sx:{display:'flex',flexDirection:'row',gap:2,flexWrap:'wrap'},children:recentlyPlayed.slice(0,8).map(track=>/*#__PURE__*/_jsx(Tooltip,{title:track.play_count===1?'Played once':`Played ${track.play_count||0} times`,arrow:true,children:/*#__PURE__*/_jsx(\"div\",{style:{minWidth:220,flex:'1 0 220px'},children:/*#__PURE__*/_jsx(AudioPlayer,{track:track,onPlay:track=>handlePlayTrack(track),compact:true})})},track.id))})]}),/*#__PURE__*/_jsx(Box,{sx:{mt:8,mb:4},children:/*#__PURE__*/_jsx(Typography,{variant:\"h4\",sx:{fontWeight:'bold',mb:2},children:\"AI Picks For You\"})})]});};export default Search;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}