{"ast":null,"code":"import React,{useState}from'react';import{Container,Typography,Paper,TextField,Button,Box,Alert,LinearProgress,Card,CardContent}from'@mui/material';import{CloudUpload}from'@mui/icons-material';import{tracksAPI}from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Upload=()=>{const[formData,setFormData]=useState({title:'',artist:'',album:'',genre:'',lyrics:''});// const [generatingLyrics, setGeneratingLyrics] = useState(false);\nconst[file,setFile]=useState(null);const[uploading,setUploading]=useState(false);const[progress,setProgress]=useState(0);const[message,setMessage]=useState('');const[error,setError]=useState('');const handleChange=e=>{setFormData({...formData,[e.target.name]:e.target.value});};// Auto-convert plain lyrics to basic LRC (5s per line)\nconst convertLyricsToLRC=plainLyrics=>{if(!plainLyrics)return'';const lines=plainLyrics.split(/\\r?\\n/).filter(line=>line.trim()!=='');return lines.map((line,idx)=>{const min=Math.floor(idx*5/60).toString().padStart(2,'0');const sec=(idx*5%60).toString().padStart(2,'0');return`[${min}:${sec}] ${line}`;}).join('\\n');};const handleConvertToLRC=()=>{setFormData({...formData,lyrics:convertLyricsToLRC(formData.lyrics)});};const handleFileChange=e=>{const selectedFile=e.target.files[0];if(selectedFile){console.log('=== FILE SELECTION DEBUG ===');console.log('Selected file:',selectedFile);console.log('File name:',selectedFile.name);console.log('File type:',selectedFile.type);console.log('File size:',selectedFile.size);// Validate file type\nconst allowedTypes=['audio/mpeg','audio/wav','audio/flac','audio/aac','audio/ogg','audio/mp4','video/mp4','application/octet-stream'];if(!allowedTypes.includes(selectedFile.type)){console.log('File type validation failed. Allowed types:',allowedTypes);setError('Please select a valid audio or MP4 file (MP3, WAV, FLAC, AAC, OGG, MP4)');return;}// Validate file size (100MB limit)\nif(selectedFile.size>100*1024*1024){console.log('File size validation failed. Size:',selectedFile.size);setError('File size must be less than 100MB');return;}setFile(selectedFile);setError('');}};const handleSubmit=async e=>{e.preventDefault();if(!file){setError('Please select an audio file');return;}if(!formData.title||!formData.artist){setError('Title and Artist are required');return;}setUploading(true);setError('');setMessage('');setProgress(0);console.log('=== UPLOAD DEBUG ===');console.log('File:',file);console.log('Form data:',formData);console.log('Token from localStorage:',localStorage.getItem('token'));try{const uploadFormData=new FormData();uploadFormData.append('audio',file);uploadFormData.append('title',formData.title);uploadFormData.append('artist',formData.artist);uploadFormData.append('album',formData.album);uploadFormData.append('genre',formData.genre);if(formData.lyrics){uploadFormData.append('lyrics',formData.lyrics);}console.log('FormData contents:');for(let pair of uploadFormData.entries()){console.log(pair[0]+':',pair[1]);}console.log('Making API call...');const response=await tracksAPI.upload(uploadFormData);console.log('Upload response:',response.data);setMessage('Track uploaded successfully! Processing audio...');// Reset form\nsetFormData({title:'',artist:'',album:'',genre:'',lyrics:''});setFile(null);// Reset file input\nconst fileInput=document.getElementById('audio-file');if(fileInput){fileInput.value='';}}catch(error){var _error$response,_error$response$data;console.error('Upload error:',error);console.error('Error response:',error.response);setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Upload failed');}finally{setUploading(false);setProgress(0);}};return/*#__PURE__*/_jsxs(Container,{maxWidth:\"md\",sx:{py:4,mb:10},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,sx:{fontWeight:'bold'},children:\"Upload Track\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",paragraph:true,children:\"Share your music with the OpenStream community\"}),/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:4,backgroundColor:'#1e1e1e'},children:[error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:3},children:error}),message&&/*#__PURE__*/_jsx(Alert,{severity:\"success\",sx:{mb:3},children:message}),uploading&&/*#__PURE__*/_jsxs(Box,{sx:{mb:3},children:[/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:progress}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mt:1},children:[\"Uploading... \",progress,\"%\"]})]}),/*#__PURE__*/_jsxs(Box,{component:\"form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(Card,{sx:{mb:3,backgroundColor:'#2a2a2a'},children:/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{border:'2px dashed #1DB954',borderRadius:2,p:4,textAlign:'center',cursor:'pointer','&:hover':{backgroundColor:'rgba(29, 185, 84, 0.1)'}},onClick:()=>document.getElementById('audio-file').click(),children:[/*#__PURE__*/_jsx(CloudUpload,{sx:{fontSize:48,color:'#1DB954',mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:file?file.name:'Click to select audio file'}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"Supported formats: MP3, WAV, FLAC, AAC, OGG (Max 100MB)\"}),/*#__PURE__*/_jsx(\"input\",{id:\"audio-file\",type:\"file\",accept:\"audio/*,video/mp4\",onChange:handleFileChange,style:{display:'none'},disabled:uploading})]})})}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,required:true,label:\"Track Title\",name:\"title\",value:formData.title,onChange:handleChange,disabled:uploading,sx:{mb:3}}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,required:true,label:\"Artist\",name:\"artist\",value:formData.artist,onChange:handleChange,disabled:uploading,sx:{mb:3}}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Album\",name:\"album\",value:formData.album,onChange:handleChange,disabled:uploading,sx:{mb:3}}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Genre\",name:\"genre\",value:formData.genre,onChange:handleChange,disabled:uploading,sx:{mb:3}}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Lyrics (optional)\",name:\"lyrics\",value:formData.lyrics,onChange:handleChange,multiline:true,minRows:4,maxRows:12,disabled:uploading,sx:{mb:2},placeholder:\"Paste lyrics (optional, or click 'Convert to LRC' for sync)\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:handleConvertToLRC,disabled:uploading||!formData.lyrics,sx:{mb:2,ml:0},children:\"Convert to LRC (Sync Lyrics)\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",size:\"large\",disabled:uploading||!file,sx:{mt:2,ml:2},children:uploading?'Uploading...':'Upload Track'})]})]})]});};export default Upload;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}