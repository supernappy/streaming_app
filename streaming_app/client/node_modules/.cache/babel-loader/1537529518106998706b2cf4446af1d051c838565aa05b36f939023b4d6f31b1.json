{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Container,Typography,Grid,Card,CardContent,Box,Tabs,Tab,TextField,Button,IconButton,Dialog,DialogTitle,DialogContent,DialogActions,Alert,Snackbar,Chip,List,ListItem,ListItemText,ListItemSecondaryAction,Checkbox,Divider}from'@mui/material';import{Add,PlayArrow,Delete,Favorite,FavoriteBorder,MoreVert,Share,MusicNote}from'@mui/icons-material';import axios from'axios';import{usePlayer}from'../contexts/PlayerContext';import Tooltip from'@mui/material/Tooltip';import AudioPlayer from'../components/AudioPlayer';import TrackCard from'../components/TrackCard';import useSyncTrackCounts from'../hooks/useSyncTrackCounts';import{formatPlays}from'../utils/format';// Configure axios defaults\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";axios.defaults.baseURL='http://localhost:5002';axios.defaults.withCredentials=true;// Add auth token to requests\naxios.interceptors.request.use(config=>{const token=localStorage.getItem('token');if(token){config.headers.Authorization=`Bearer ${token}`;}return config;});const Playlists=()=>{var _selectedPlaylist$tra,_selectedPlaylist$tra2,_selectedPlaylist$tra3;const[playlists,setPlaylists]=useState([]);const[selectedPlaylist,setSelectedPlaylist]=useState(null);const[availableTracks,setAvailableTracks]=useState([]);const[syncedAvailableTracks,setSyncedAvailableTracks]=useSyncTrackCounts([]);const[loading,setLoading]=useState(true);const[createDialogOpen,setCreateDialogOpen]=useState(false);const[addTracksDialogOpen,setAddTracksDialogOpen]=useState(false);const[selectedTracks,setSelectedTracks]=useState([]);const[error,setError]=useState(null);const[success,setSuccess]=useState(null);const[newPlaylist,setNewPlaylist]=useState({name:'',description:'',is_public:false});const{playTrack,recentlyPlayed}=usePlayer?usePlayer():{playTrack:()=>{},recentlyPlayed:[]};const[syncedPlaylistTracks,setSyncedPlaylistTracks]=useSyncTrackCounts([]);useEffect(()=>{fetchPlaylists();fetchAvailableTracks();},[]);const fetchAvailableTracks=async()=>{try{const response=await axios.get('/api/tracks');const list=response.data.tracks||[];setAvailableTracks(list);setSyncedAvailableTracks(list);}catch(error){console.error('Error fetching tracks:',error);}};const fetchPlaylists=async()=>{try{const response=await axios.get('/api/playlists');setPlaylists(response.data.playlists||[]);if(response.data.playlists&&response.data.playlists.length>0){setSelectedPlaylist(response.data.playlists[0]);fetchPlaylistTracks(response.data.playlists[0].id);}}catch(error){console.error('Error fetching playlists:',error);setError('Failed to load playlists. Please try again.');}finally{setLoading(false);}};const fetchPlaylistTracks=async playlistId=>{try{var _response$data$playli;const response=await axios.get(`/api/playlists/${playlistId}`);setSelectedPlaylist(response.data.playlist);setSyncedPlaylistTracks(((_response$data$playli=response.data.playlist)===null||_response$data$playli===void 0?void 0:_response$data$playli.tracks)||[]);}catch(error){console.error('Error fetching playlist tracks:',error);}};const handleCreatePlaylist=async()=>{if(!newPlaylist.name)return;try{await axios.post('/api/playlists',newPlaylist);setCreateDialogOpen(false);setNewPlaylist({name:'',description:'',is_public:false});setSuccess('Playlist created successfully!');fetchPlaylists();}catch(error){console.error('Error creating playlist:',error);setError('Failed to create playlist. Please try again.');}};const handleAddTracks=async()=>{if(!selectedPlaylist||selectedTracks.length===0)return;try{// Add each selected track to the playlist\nfor(const trackId of selectedTracks){await axios.post(`/api/playlists/${selectedPlaylist.id}/tracks`,{track_id:trackId});}setAddTracksDialogOpen(false);setSelectedTracks([]);setSuccess(`Added ${selectedTracks.length} track(s) to playlist!`);fetchPlaylistTracks(selectedPlaylist.id);}catch(error){console.error('Error adding tracks to playlist:',error);setError('Failed to add tracks to playlist. Please try again.');}};const handleRemoveTrack=async trackId=>{if(!selectedPlaylist)return;try{await axios.delete(`/api/playlists/${selectedPlaylist.id}/tracks/${trackId}`);setSuccess('Track removed from playlist!');fetchPlaylistTracks(selectedPlaylist.id);}catch(error){console.error('Error removing track from playlist:',error);setError('Failed to remove track. Please try again.');}};const handleTrackSelection=trackId=>{setSelectedTracks(prev=>prev.includes(trackId)?prev.filter(id=>id!==trackId):[...prev,trackId]);};const handlePlayPlaylist=()=>{if((syncedPlaylistTracks===null||syncedPlaylistTracks===void 0?void 0:syncedPlaylistTracks.length)>0){playTrack(syncedPlaylistTracks[0],syncedPlaylistTracks);}};if(loading){return/*#__PURE__*/_jsx(Container,{sx:{py:4},children:/*#__PURE__*/_jsx(Typography,{children:\"Loading playlists...\"})});}return/*#__PURE__*/_jsxs(Container,{maxWidth:\"lg\",sx:{py:4,mb:10},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,sx:{fontWeight:'bold'},children:\"My Playlists\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:()=>setCreateDialogOpen(true),children:\"Create Playlist\"})]}),playlists.length>0?/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Box,{sx:{position:'sticky',top:20},children:playlists.map(playlist=>/*#__PURE__*/_jsx(Card,{sx:{mb:2,backgroundColor:(selectedPlaylist===null||selectedPlaylist===void 0?void 0:selectedPlaylist.id)===playlist.id?'#2a2a2a':'#1e1e1e',cursor:'pointer','&:hover':{backgroundColor:'#2a2a2a'}},onClick:()=>fetchPlaylistTracks(playlist.id),children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{color:'#fff'},children:playlist.name}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[playlist.track_count||0,\" tracks\"]}),playlist.description&&/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{mt:1},children:playlist.description})]})},playlist.id))})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:8,children:selectedPlaylist?/*#__PURE__*/_jsx(Card,{sx:{backgroundColor:'#1e1e1e'},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'start',mb:3},children:[/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,sx:{color:'#fff'},children:selectedPlaylist.name}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[((_selectedPlaylist$tra=selectedPlaylist.tracks)===null||_selectedPlaylist$tra===void 0?void 0:_selectedPlaylist$tra.length)||0,\" tracks \\u2022 by \",selectedPlaylist.owner_username]}),selectedPlaylist.description&&/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{mt:1},children:selectedPlaylist.description})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:()=>setAddTracksDialogOpen(true),sx:{borderColor:'#1DB954',color:'#1DB954','&:hover':{borderColor:'#1ed760',color:'#1ed760'}},children:\"Add Tracks\"}),((_selectedPlaylist$tra2=selectedPlaylist.tracks)===null||_selectedPlaylist$tra2===void 0?void 0:_selectedPlaylist$tra2.length)>0&&/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(PlayArrow,{}),onClick:handlePlayPlaylist,sx:{backgroundColor:'#1DB954','&:hover':{backgroundColor:'#1ed760'}},children:\"Play All\"})]})]}),((_selectedPlaylist$tra3=selectedPlaylist.tracks)===null||_selectedPlaylist$tra3===void 0?void 0:_selectedPlaylist$tra3.length)>0?/*#__PURE__*/_jsx(Box,{sx:{display:'flex',flexDirection:'column',gap:2},children:syncedPlaylistTracks.map((track,index)=>/*#__PURE__*/_jsx(TrackCard,{track:track,onPlay:()=>playTrack(track,syncedPlaylistTracks),showActions:true},track.id))}):/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center',py:4},children:[/*#__PURE__*/_jsx(MusicNote,{sx:{fontSize:60,color:'text.secondary',mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",gutterBottom:true,children:\"This playlist is empty\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{mb:3},children:\"Add some tracks to get started\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:()=>setAddTracksDialogOpen(true),sx:{backgroundColor:'#1DB954','&:hover':{backgroundColor:'#1ed760'}},children:\"Add Tracks\"})]})]})}):/*#__PURE__*/_jsx(Card,{sx:{backgroundColor:'#1e1e1e'},children:/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body1\",color:\"text.secondary\",sx:{textAlign:'center',py:4},children:\"Select a playlist to view its tracks\"})})})})]}):/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center',py:8},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"text.secondary\",gutterBottom:true,children:\"No playlists yet\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"Create your first playlist to organize your favorite tracks\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:()=>setCreateDialogOpen(true),sx:{mt:2},children:\"Create Playlist\"})]}),/*#__PURE__*/_jsxs(Dialog,{open:createDialogOpen,onClose:()=>setCreateDialogOpen(false),maxWidth:\"sm\",fullWidth:true,PaperProps:{sx:{backgroundColor:'#2a2a2a',color:'#fff'}},children:[/*#__PURE__*/_jsx(DialogTitle,{sx:{color:'#fff'},children:\"Create New Playlist\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",label:\"Playlist Name\",fullWidth:true,variant:\"outlined\",value:newPlaylist.name,onChange:e=>setNewPlaylist({...newPlaylist,name:e.target.value}),sx:{mb:2,'& .MuiOutlinedInput-root':{'& fieldset':{borderColor:'rgba(255,255,255,0.3)'},'&:hover fieldset':{borderColor:'rgba(255,255,255,0.5)'},'&.Mui-focused fieldset':{borderColor:'#1DB954'}},'& .MuiInputBase-input':{color:'#fff'},'& .MuiInputLabel-root':{color:'rgba(255,255,255,0.7)'}}}),/*#__PURE__*/_jsx(TextField,{margin:\"dense\",label:\"Description (optional)\",fullWidth:true,multiline:true,rows:3,variant:\"outlined\",value:newPlaylist.description,onChange:e=>setNewPlaylist({...newPlaylist,description:e.target.value}),sx:{'& .MuiOutlinedInput-root':{'& fieldset':{borderColor:'rgba(255,255,255,0.3)'},'&:hover fieldset':{borderColor:'rgba(255,255,255,0.5)'},'&.Mui-focused fieldset':{borderColor:'#1DB954'}},'& .MuiInputBase-input':{color:'#fff'},'& .MuiInputLabel-root':{color:'rgba(255,255,255,0.7)'}}})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setCreateDialogOpen(false),sx:{color:'#ccc'},children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleCreatePlaylist,variant:\"contained\",disabled:!newPlaylist.name,sx:{backgroundColor:'#1DB954','&:hover':{backgroundColor:'#1ed760'}},children:\"Create Playlist\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:addTracksDialogOpen,onClose:()=>setAddTracksDialogOpen(false),maxWidth:\"md\",fullWidth:true,PaperProps:{sx:{backgroundColor:'#2a2a2a',color:'#fff',maxHeight:'80vh'}},children:[/*#__PURE__*/_jsxs(DialogTitle,{sx:{color:'#fff'},children:[\"Add Tracks to \\\"\",selectedPlaylist===null||selectedPlaylist===void 0?void 0:selectedPlaylist.name,\"\\\"\"]}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{mb:2},children:\"Select tracks to add to your playlist\"}),syncedAvailableTracks.length>0?/*#__PURE__*/_jsx(List,{sx:{maxHeight:400,overflow:'auto'},children:syncedAvailableTracks.map(track=>/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(ListItem,{sx:{borderRadius:1,mb:1,backgroundColor:selectedTracks.includes(track.id)?'rgba(29, 185, 84, 0.1)':'transparent','&:hover':{backgroundColor:'rgba(255, 255, 255, 0.05)'}},children:[/*#__PURE__*/_jsx(Checkbox,{checked:selectedTracks.includes(track.id),onChange:()=>handleTrackSelection(track.id),sx:{color:'#1DB954','&.Mui-checked':{color:'#1DB954'}}}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsx(Typography,{sx:{color:'#fff'},children:track.title}),secondary:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{color:'#ccc'},children:track.artist}),/*#__PURE__*/_jsx(Chip,{label:formatPlays(typeof track.play_count==='number'?track.play_count:0),size:\"small\",variant:\"outlined\",sx:{color:'#ccc',borderColor:'#555',height:20}})]})})]}),/*#__PURE__*/_jsx(Divider,{sx:{backgroundColor:'rgba(255,255,255,0.1)'}})]},track.id))}):/*#__PURE__*/_jsx(Typography,{color:\"text.secondary\",sx:{textAlign:'center',py:4},children:\"No tracks available to add\"})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>{setAddTracksDialogOpen(false);setSelectedTracks([]);},sx:{color:'#ccc'},children:\"Cancel\"}),/*#__PURE__*/_jsxs(Button,{onClick:handleAddTracks,variant:\"contained\",disabled:selectedTracks.length===0,sx:{backgroundColor:'#1DB954','&:hover':{backgroundColor:'#1ed760'}},children:[\"Add \",selectedTracks.length,\" Track\",selectedTracks.length!==1?'s':'']})]})]}),/*#__PURE__*/_jsx(Snackbar,{open:!!error,autoHideDuration:6000,onClose:()=>setError(null),children:/*#__PURE__*/_jsx(Alert,{onClose:()=>setError(null),severity:\"error\",children:error})}),/*#__PURE__*/_jsx(Snackbar,{open:!!success,autoHideDuration:4000,onClose:()=>setSuccess(null),children:/*#__PURE__*/_jsx(Alert,{onClose:()=>setSuccess(null),severity:\"success\",children:success})}),recentlyPlayed&&recentlyPlayed.length>0&&/*#__PURE__*/_jsxs(Box,{sx:{mt:6,mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{fontWeight:'bold',mb:2},children:\"Recently Played\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:recentlyPlayed.slice(0,8).map(track=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(TrackCard,{track:track,onPlay:()=>playTrack(track),showActions:true})},track.id))})]}),/*#__PURE__*/_jsx(Box,{sx:{mt:8,mb:4},children:/*#__PURE__*/_jsx(Typography,{variant:\"h4\",sx:{fontWeight:'bold',mb:2},children:\"AI Picks For You\"})})]});};export default Playlists;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}